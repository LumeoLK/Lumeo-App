<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Reset Password</title>

    <style>
      body {
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial;
      }

      #modal {
        background: white;
        width: 350px;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      input,
      button {
        margin-top: 10px;
        padding: 10px;
        border-radius: 7px;
        border: 1px solid #ccc;
      }
      input {
        width: 94%;
      }

      button {
        width: 100%;
        background: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="modal">
      <h3>Reset Password</h3>

      <input type="password" id="password" placeholder="New Password" />
      <input type="password" id="confirm" placeholder="Confirm Password" />

      <button onclick="submitPassword()">Submit</button>

      <p id="msg" style="color: red; margin-top: 10px"></p>
    </div>

    <script>
      // Extract token from URL
      const token = window.location.pathname.split("/").pop();

      async function submitPassword() {
        const password = document.getElementById("password").value;
        const confirm = document.getElementById("confirm").value;
        const msg = document.getElementById("msg");

        if (password !== confirm) {
          msg.textContent = "Passwords do not match";
          return;
        }

        // ✅ FIXED: Use relative URL with token in path, not body
        const res = await fetch(`/resetPassword/${token}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password }), // ✅ Only send password, not token
        });

        const data = await res.json();

        if (res.ok) {
          msg.style.color = "green";
          msg.textContent = "Password updated successfully!";
        } else {
          msg.textContent = data.msg || "Error updating password";
        }
      }
    </script>
  </body>
</html>
